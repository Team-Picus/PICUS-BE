<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Chat UI Test</title>
    <!-- SockJS와 STOMP 라이브러리 로드 (CDN 사용) -->
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<h1>Chat UI Test</h1>
<div>
    <label>Room ID:</label>
    <input id="roomId" type="text" value="room123">
    <button onclick="connect()">Connect</button>
</div>
<div id="messages" style="border:1px solid #ccc; height:300px; overflow-y:scroll; margin-top:10px; padding:5px;">
    <!-- 메시지가 표시됩니다 -->
</div>
<div style="margin-top:10px;">
    <input id="messageInput" type="text" placeholder="Enter message" style="width:300px;">
    <button onclick="sendMessage()">Send</button>
</div>

<script>
    let stompClient = null;

    function connect() {
        const socket = new SockJS('/ws');
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function(frame) {
            console.log('Connected: ' + frame);
            const roomId = document.getElementById('roomId').value;
            // 채팅방 토픽 구독 (1대1 채팅의 경우, 해당 채팅방을 구독)
            stompClient.subscribe('/topic/chat/' + roomId, function(message) {
                const chatMessage = JSON.parse(message.body);
                displayMessage(chatMessage);
            });
        });
    }

    function sendMessage() {
        const roomId = document.getElementById('roomId').value;
        const content = document.getElementById('messageInput').value;
        // 예시 메시지 객체 (sender는 실제 사용자 정보로 대체)
        const message = {
            roomId: roomId,
            sender: "testUser",
            content: content
        };
        stompClient.send("/app/chat.send", {}, JSON.stringify(message));
    }

    function displayMessage(msg) {
        const messagesDiv = document.getElementById('messages');
        const messageElement = document.createElement('div');
        messageElement.innerText = msg.sender + ": " + msg.content + " (" + (msg.createdAt || new Date().toISOString()) + ")";
        messagesDiv.appendChild(messageElement);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
</script>
</body>
</html>
